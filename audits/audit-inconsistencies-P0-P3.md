# Audit: Use Case Document Inconsistencies (P0–P4)

**Date:** February 19, 2026
**Audited Document:** `usecases/use-case-analysis-P0-P4.md` (v1.0, generated by Haiku 4.5)
**Auditor:** Sonnet 4.6 (review) → Opus 4.6 (fixes)
**Result Document:** `usecases/use-case-analysis-P0-P4.md` (v1.1, corrected)

## Summary

The use case document was generated by Claude Haiku 4.5 from a codebase read. The
parameter tables (all 12 slider configs) and architecture descriptions were accurate.
However, 8 factual inconsistencies were found against the implemented codebase, all
corrected in v1.1.

**Root cause pattern:** The generating model conflated "UI element exists" with "feature
is functionally implemented" and did not cross-check claims against the actual code
paths. It also suffered from a stale file read — the handler.rs it analyzed was missing
the P4 `a` key binding that existed in the current codebase.

---

## Findings

### F1. OGG Vorbis listed as supported — not in Cargo.toml

**Severity:** Factual error
**Location:** Section 1 UC1, Audio Format Support table
**Detail:** Document listed OGG Vorbis as a supported input format.
`Cargo.toml` declares `symphonia` features as `["mp3", "wav", "pcm", "flac"]`.
The `vorbis` feature is not enabled; OGG files cannot be decoded.
**Fix:** Removed OGG from supported formats list.

---

### F2. CLI file loading self-contradiction

**Severity:** Self-contradiction
**Location:** Section 1 UC5 (marked ◊ planned) vs Section 11 UC4 (marked ✓ implemented)
**Detail:** The same feature — loading audio via command-line argument — appeared twice
with opposite implementation status. `main.rs` lines 59–73 implement it: the program
checks `args.len() >= 2` and calls `load_file(&args[1], ...)`.
**Fix:** Marked as ✓ in Section 1. Removed the duplicate from Section 11 to avoid
redundancy.

---

### F3. File error messages marked ◊ planned — actually implemented

**Severity:** Wrong status marker
**Location:** Section 1 UC4
**Detail:** Labeled "◊ planned P7 with export." In reality, `handler.rs` lines 31–36
set `app.status_message` for both "File not found: {path}" and "Path is not a file"
when Enter is pressed in the file picker. Also claimed "displays error for 3 seconds
before clearing" — there is no timer; messages persist until the next successful file
load.
**Fix:** Changed to ✓. Corrected clearing behavior description.

---

### F4. Fine pitch adjustment stated as ±0.2 semitones — actually ±0.1

**Severity:** Numerical error
**Location:** Section 3 UC3
**Detail:** Document stated "Fine adjustment: ±0.2 semitones per keystroke."
`SliderDef::adjust(steps)` computes `value += steps × self.step`. Shift+arrows pass
`±0.2` as steps; Pitch Shift has step = 0.5 st. Result: `0.2 × 0.5 = 0.1 st`.
Section 5 UC8 correctly showed "Example: Pitch Shift +0.1 semitones per keystroke,"
creating an internal contradiction within the document.
**Fix:** Changed to "±0.1 semitones per keystroke (0.2 steps × 0.5 st/step)."

---

### F5. Status bar format example incorrect

**Severity:** Factual error
**Location:** Section 1 UC3
**Detail:** Showed example `File: speech.wav | 44100 Hz | Mono | Processing: 12ms`.
Actual rendering in `status_bar.rs`:
- Uses `│` (Unicode box-drawing), not `|` (pipe)
- Fourth field is duration in `M:SS` format, not a processing time
- `processing_status` is appended separately in yellow when set (e.g., "Analyzing...")
- No millisecond timing is ever displayed
**Fix:** Changed example to ` File: speech.wav │ 44100 Hz │ Mono │ 3:45` and noted
processing status is appended separately.

---

### F6. Status messages claimed to auto-clear — they don't

**Severity:** Behavioral error
**Location:** Section 11 UC2
**Detail:** Stated "Messages auto-clear after operation completes." There is no
timer-based clearing mechanism. `processing_status` is set to `None` on
`AnalysisDone`/`SynthesisDone`, but `status_message` persists until explicitly cleared
via `app.status_message = None` — which only happens on a successful `LoadFile` action
in `main.rs` line 185.
**Fix:** Changed to "Processing status clears on completion; error messages persist
until next successful file load."

---

### F7. A/B transport display described as `[A] Original` — actually just `[A]`

**Severity:** Factual error
**Location:** Section 6 UC1
**Detail:** Document claimed transport shows `[A] Original` or `[B] Processed`.
`transport.rs` line 31 renders only `[A]` or `[B]` (single letter in brackets,
styled magenta). No descriptive text ("Original"/"Processed") is displayed.
**Fix:** Changed to "`[A]` or `[B]` indicator in magenta."

---

### F8. All 11 effects use cases marked ✓ — audio processing not implemented

**Severity:** Major status misclassification
**Location:** Section 4, all 11 use cases
**Detail:** Every effect (gain, filters, compression, reverb, pitch shift FX) was
marked ✓ with behavioral descriptions (e.g., "Reduces loud peaks above threshold,"
"Blends dry signal with reverb impulse response"). No effects processing code exists
in the codebase. The `effects_sliders` values are stored in `AppState` and rendered in
the UI, but nothing reads them for audio processing. This is explicitly planned for P6
per CLAUDE.md and `plans/P6-effects-chain.md`.

The document even acknowledged this in its own "Known Limitations" section: "Effects
not yet applied to output (P6 dependency)" — contradicting its own ✓ markers.

`write_audio_data` in `playback.rs` copies raw PCM samples directly to output with
no processing. The `processing_loop` in `processing.rs` only handles WORLD
analysis/synthesis — no effects chain.

**Fix:** Changed all 10 audio-processing use cases to ◊ (planned P6). Kept UC11
("adjust effects sliders without triggering WORLD re-synthesis") as ✓ since the
slider interaction behavior is correctly implemented. Added note at section top
clarifying the UI-vs-processing distinction.

---

## Additional Corrections (non-findings)

### Count reconciliation

The original document had three mutually inconsistent counts:
- Header: "53 (45 Implemented + 8 Planned)"
- Summary table: "62 total, 52 implemented, 20 planned"
- Section 3 heading: "12 use cases" but lists 13 items

**Fix:** Recounted all sections after corrections. Updated header, summary table,
and section headings to consistent values: 72 total (48 implemented + 24 planned).

### A/B indicator use case status

Section 6 UC5 was marked ◊ ("will display Original [●] / Processed [○]"). The `[A]`/
`[B]` indicator is already rendered in `transport.rs`. Changed to ✓ with accurate
description.

### P4 roadmap status

Implementation roadmap showed P4 as "In progress." The current codebase has complete
P4 implementation: `Action::ToggleAB`, `swap_audio`, handler binding, main.rs handler
with position scaling. Changed to "✓ Complete."

### Section 7 (UI Navigation)

All 7 use cases were already implemented but the summary table showed "5 implemented,
2 planned." Corrected to 7/0.

### Threading notes

Removed false claim about effects chain being applied in the playback thread.

---

## Methodology

1. Read the generated document (`v1.0`)
2. Cross-referenced every ✓/◊ claim against source files:
   - `src/input/handler.rs` — all key bindings
   - `src/app.rs` — `AppState` fields, `Action` enum, slider definitions
   - `src/main.rs` — action handlers, processing result handlers
   - `src/audio/playback.rs` — `write_audio_data`, `swap_audio`, `CallbackContext`
   - `src/dsp/processing.rs` — `ProcessingCommand`/`ProcessingResult`, processing loop
   - `src/dsp/modifier.rs` — `WorldSliderValues`, `apply()`
   - `src/ui/status_bar.rs` — status bar rendering format
   - `src/ui/transport.rs` — transport bar rendering, A/B indicator
   - `Cargo.toml` — symphonia features (format support)
3. Verified numerical claims (slider ranges, step calculations) against `SliderDef` constructors
4. Applied all corrections to produce `v1.1`

## What the Generator Got Right

- All 6 WORLD slider parameter ranges, defaults, steps, and units: **exact match** to `default_world_sliders()`
- All 6 effects slider parameter ranges, defaults, steps: **exact match** to `default_effects_sliders()`
- WORLD modifier transform descriptions (pitch shift, pitch range, speed, breathiness, formant shift, spectral tilt): **accurate** per `modifier.rs`
- Keyboard shortcut table (post-P4): **correct** — all 14 implemented bindings present
- Architecture and threading model: **accurate** (minus the effects claim)
- Phase roadmap (P0–P3b complete, P5–P8 planned): **correct**
- Debounce timing (150ms), neutral-slider shortcut, mono output behavior: **correct**
